FROM alpine:3.16.0 as base
LABEL maintainer="opensource@ekino.com"
ARG HELM_DIFF_VERSION
ARG HELM_VERSION
ARG KUBECTL_VERSION
ARG KUBENT_VERSION
ARG KUBESCORE_VERSION
ARG KUBEVAL_VERSION
ARG KUSTOMIZATION_VERSION
ARG TARGETARCH
ARG TRIVY_VERSION
ENV PATH="${PATH}:/usr/bin"
ENV GLIBC_VER=2.31-r0

FROM base as base-amd64
ARG KUSTOMIZATION_ARCH="linux_amd64"
ARG KUBESCORE_ARCH="linux_amd64"
ARG TRIVY_ARCH="Linux-64bit"
ARG KUBENT_ARCH="linux-amd64"
ARG AWSCLI_ARCH="x86_64"

FROM base as base-arm64
ARG KUSTOMIZATION_ARCH="linux_arm64"
ARG KUBESCORE_ARCH="linux_arm64"
ARG TRIVY_ARCH="Linux-ARM64"
ARG KUBENT_ARCH="linux-arm64"
ARG AWSCLI_ARCH="aarch64"

FROM base-${TARGETARCH}
COPY run.sh .
RUN ./run.sh
