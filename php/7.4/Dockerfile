FROM php:7.4.29-cli-alpine3.15
LABEL maintainer="RÃ©mi Marseille <marseille@ekino.com>"

ARG APCU_VERSION
ARG CI_HELPER_VERSION
ARG COMPOSER_VERSION
ARG ICONV_VERSION
ARG MEMCACHED_VERSION
ARG MODD_VERSION
ARG MUSL_VERSION
ARG PHP_CS_FIXER_VERSION
ARG REDIS_VERSION
ARG SECURITY_CHECKER_VERSION
ARG SSH2_VERSION
ARG XDEBUG_VERSION

# iconv issue https://github.com/docker-library/php/issues/240

ENV COMPOSER_NO_INTERACTION=1 \
    COMPOSER_MEMORY_LIMIT=-1 \
    TERM=xterm \
    LD_PRELOAD="/usr/lib/preloadable_libiconv.so php" \
    PHP_CPPFLAGS="$PHP_CPPFLAGS -std=c++11"

COPY run.sh .
RUN sh run.sh
